<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrono-Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #f59e0b;
            --accent: #10b981;
            --sky-top: #2e1065;
            --sky-bottom: #020617;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: radial-gradient(circle at center, var(--sky-top), var(--sky-bottom));
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
            transition: background 1.5s ease;
        }

        .font-title { font-family: 'Fredoka One', cursive; }

        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
        }

        .clock-container {
            position: relative;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.5));
        }

        .hand {
            stroke-linecap: round;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4));
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hand-hitbox {
            stroke: transparent;
            stroke-width: 30px;
            cursor: pointer;
        }

        @keyframes pulse-hint {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.5; stroke: #fbbf24; }
        }
        .hint-active { animation: pulse-hint 1s infinite; }

        .pop-in {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        #confetti-canvas {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none;
            z-index: 100;
        }
        
        .day-theme {
            --sky-top: #38bdf8;
            --sky-bottom: #1d4ed8;
        }
        
        .night-theme {
            --sky-top: #2e1065;
            --sky-bottom: #020617;
        }
    </style>
</head>
<body class="night-theme">

    <canvas id="confetti-canvas"></canvas>

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 z-50 flex items-center justify-center p-6">
        <div class="glass-card p-12 max-w-lg w-full text-center pop-in">
            <div class="mb-8 flex justify-center">
                <svg width="120" height="120" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#f59e0b" stroke-width="2" stroke-dasharray="2 4"/>
                    <circle cx="50" cy="50" r="38" fill="#6366f1" opacity="0.3"/>
                    <path d="M50 15 L50 50 L75 50" stroke="white" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
            </div>
            <h1 class="text-5xl font-title mb-4 tracking-wide">CHRONO MASTER</h1>
            <p class="text-indigo-100 text-lg mb-8 italic">"The Ultimate Time-Reading Quest!"</p>
            <div class="space-y-4">
                <button onclick="startGame()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-purple-950 font-title text-2xl py-5 px-12 rounded-full shadow-2xl transition-all transform hover:scale-105 active:scale-95">
                    START MISSION
                </button>
            </div>
        </div>
    </div>

    <!-- Main Game Area -->
    <div id="game-ui" class="hidden w-full max-w-6xl px-4 flex flex-col lg:flex-row items-center justify-center gap-10">
        
        <!-- Dashboard -->
        <div class="glass-card p-8 w-full lg:w-72 flex flex-row lg:flex-col justify-around lg:justify-center items-center gap-6 border-b-4 lg:border-b-0 lg:border-l-4 border-indigo-500">
            <div class="text-center">
                <p class="text-xs uppercase tracking-widest text-indigo-300 mb-1">Level</p>
                <p id="level-display" class="text-4xl font-title text-white">1</p>
            </div>
            <div class="text-center">
                <p class="text-xs uppercase tracking-widest text-indigo-300 mb-1">Score</p>
                <p id="score" class="text-5xl font-title text-yellow-400">0</p>
            </div>
            <div class="text-center">
                <p class="text-xs uppercase tracking-widest text-indigo-300 mb-1">Time</p>
                <p id="timer" class="text-5xl font-title text-white">60s</p>
            </div>
            <div id="stars-row" class="flex gap-1"></div>
        </div>

        <!-- Center Stage -->
        <div class="flex flex-col items-center">
            <!-- Target Display -->
            <div id="target-display" class="glass-card px-10 py-6 mb-6 border-2 border-white/20 text-center min-w-[300px]">
                <div class="flex items-center justify-center gap-2 mb-1">
                    <span id="day-icon" class="text-2xl">ðŸŒ™</span>
                    <p class="text-xs uppercase tracking-widest text-indigo-200">Set the clock to:</p>
                </div>
                <p id="target-time" class="text-6xl font-title tracking-tighter text-white mb-1">12:00</p>
                <p id="target-verbal" class="text-lg font-bold text-yellow-300 uppercase opacity-90 tracking-wide">Twelve O'Clock</p>
            </div>

            <!-- Interactive Clock -->
            <div class="clock-container">
                <svg id="clock-svg" width="380" height="380" viewBox="0 0 200 200" class="select-none touch-none">
                    <defs>
                        <radialGradient id="faceGrad" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f8fafc;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    
                    <!-- Main Body -->
                    <circle cx="100" cy="100" r="98" fill="#1e1b4b" stroke="#4338ca" stroke-width="4"/>
                    <circle cx="100" cy="100" r="92" fill="url(#faceGrad)"/>
                    
                    <!-- Hint Ghosts (Hidden by default) -->
                    <line id="hour-hint" x1="100" y1="100" x2="100" y2="55" stroke="none" stroke-width="8" stroke-linecap="round" class="opacity-0 transition-opacity"/>
                    <line id="min-hint" x1="100" y1="100" x2="100" y2="30" stroke="none" stroke-width="5" stroke-linecap="round" class="opacity-0 transition-opacity"/>

                    <!-- Numerals -->
                    <g id="clock-face-elements"></g>

                    <!-- Hour Hand -->
                    <g id="hour-group" class="hand">
                        <path d="M100 105 L96 100 L100 50 L104 100 Z" fill="#1e1b4b" />
                        <line x1="100" y1="100" x2="100" y2="50" class="hand-hitbox" id="hour-trigger"/>
                    </g>

                    <!-- Minute Hand -->
                    <g id="min-group" class="hand">
                        <path d="M100 108 L97 100 L100 25 L103 100 Z" fill="#6366f1" />
                        <circle cx="100" cy="25" r="3" fill="#6366f1"/>
                        <line x1="100" y1="100" x2="100" y2="25" class="hand-hitbox" id="min-trigger"/>
                    </g>

                    <!-- Center Cap -->
                    <circle cx="100" cy="100" r="7" fill="#1e1b4b"/>
                    <circle cx="100" cy="100" r="3" fill="#818cf8"/>
                </svg>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="showHint()" class="bg-indigo-600/50 hover:bg-indigo-500 text-white font-title text-xl py-4 px-8 rounded-full shadow-lg border border-white/20 transition-all active:scale-90">
                    HINT (-50)
                </button>
                <button onclick="submitAnswer()" class="bg-emerald-500 hover:bg-emerald-400 text-white font-title text-2xl py-4 px-12 rounded-full shadow-2xl transition-all transform hover:scale-105 active:scale-95">
                    CHECK TIME
                </button>
            </div>
        </div>
    </div>

    <!-- Final Results -->
    <div id="end-screen" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/85 backdrop-blur-xl">
        <div class="glass-card p-12 max-w-md w-full text-center scale-in">
            <h2 class="text-4xl font-title mb-4">MISSION COMPLETE</h2>
            <div id="final-stars" class="flex justify-center gap-3 mb-6"></div>
            <p class="text-xl mb-2 text-indigo-200">Final Score:</p>
            <p id="final-score" class="text-7xl font-title text-yellow-400 mb-8">0</p>
            <button onclick="location.reload()" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-title py-5 rounded-2xl hover:brightness-110 transition-all text-xl">
                PLAY AGAIN
            </button>
        </div>
    </div>

    <!-- Feedback Message -->
    <div id="feedback" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 transition-all duration-300 z-50">
        <span id="feedback-text" class="text-8xl font-title drop-shadow-2xl">EXCELLENT!</span>
    </div>

    <script>
        // --- Game Logic Constants ---
        const LEVELS = [
            { name: "Beginner", points: 0, intervals: 60 },     // Only whole hours
            { name: "Apprentice", points: 400, intervals: 30 }, // Half hours
            { name: "Junior", points: 900, intervals: 15 },     // Quarters
            { name: "Expert", points: 1500, intervals: 5 }      // Full 5-min intervals
        ];

        // --- Core State ---
        let score = 0;
        let timeLeft = 60;
        let isActive = false;
        let currentTarget = { h: 3, m: 0, isAm: true };
        let playerTime = { h: 12, m: 0 };
        let activeHand = null;
        let level = 0;

        const clockFace = document.getElementById('clock-face-elements');
        const hourGroup = document.getElementById('hour-group');
        const minGroup = document.getElementById('min-group');

        function drawClock() {
            clockFace.innerHTML = '';
            // Hour markers
            for (let i = 1; i <= 12; i++) {
                const angle = i * 30 * (Math.PI / 180);
                const tx = 100 + 74 * Math.sin(angle);
                const ty = 100 - 74 * Math.cos(angle);
                
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", tx);
                text.setAttribute("y", ty + 4);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("fill", "#1e1b4b");
                text.setAttribute("font-weight", "bold");
                text.setAttribute("font-size", "14");
                text.textContent = i;
                clockFace.appendChild(text);

                // Hour Ticks
                const x1 = 100 + 86 * Math.sin(angle);
                const y1 = 100 - 86 * Math.cos(angle);
                const x2 = 100 + 91 * Math.sin(angle);
                const y2 = 100 - 91 * Math.cos(angle);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x1); line.setAttribute("y1", y1);
                line.setAttribute("x2", x2); line.setAttribute("y2", y2);
                line.setAttribute("stroke", "#1e1b4b");
                line.setAttribute("stroke-width", "3");
                clockFace.appendChild(line);
            }
        }

        function updateVisuals() {
            // Minute hand rotation
            const minAngle = playerTime.m * 6;
            minGroup.style.transform = `rotate(${minAngle}deg)`;
            minGroup.style.transformOrigin = "100px 100px";

            // Mechanical hour hand rotation (moves between hours based on minutes)
            const hourProgress = (playerTime.m / 60) * 30;
            const hourAngle = (playerTime.h % 12 * 30) + hourProgress;
            hourGroup.style.transform = `rotate(${hourAngle}deg)`;
            hourGroup.style.transformOrigin = "100px 100px";
        }

        function getTimeWords(h, m) {
            const numbers = ["Twelve", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven"];
            const hourName = numbers[h % 12];
            const nextHourName = numbers[(h + 1) % 12];

            if (m === 0) return `${hourName} O'Clock`;
            if (m === 15) return `Quarter Past ${hourName}`;
            if (m === 30) return `Half Past ${hourName}`;
            if (m === 45) return `Quarter To ${nextHourName}`;
            return `${m} Minutes Past ${hourName}`;
        }

        function generateQuestion() {
            // Determine level
            let newLevel = 0;
            LEVELS.forEach((l, idx) => { if(score >= l.points) newLevel = idx; });
            level = newLevel;
            document.getElementById('level-display').textContent = level + 1;

            const interval = LEVELS[level].intervals;
            const h = Math.floor(Math.random() * 12) + 1;
            const m = (Math.floor(Math.random() * (60 / interval))) * interval;
            const isAm = Math.random() > 0.5;

            currentTarget = { h, m, isAm };
            
            // UI Updates
            document.getElementById('target-time').textContent = `${h}:${m < 10 ? '0' + m : m}`;
            document.getElementById('target-verbal').textContent = getTimeWords(h, m);
            document.getElementById('day-icon').textContent = isAm ? "â˜€ï¸" : "ðŸŒ™";
            document.body.className = isAm ? "day-theme" : "night-theme";

            // Reset Hands
            playerTime = { h: 12, m: 0 };
            hideHint();
            updateVisuals();
        }

        // --- Hints ---
        function showHint() {
            if (score < 50) return;
            score -= 50;
            document.getElementById('score').textContent = score;

            const hHint = document.getElementById('hour-hint');
            const mHint = document.getElementById('min-hint');

            // Set hint rotation
            const minAngle = currentTarget.m * 6;
            const hourAngle = (currentTarget.h % 12 * 30) + (currentTarget.m / 60 * 30);

            hHint.setAttribute('stroke', '#fbbf24');
            mHint.setAttribute('stroke', '#6366f1');
            
            hHint.style.transform = `rotate(${hourAngle}deg)`;
            hHint.style.transformOrigin = "100px 100px";
            mHint.style.transform = `rotate(${minAngle}deg)`;
            mHint.style.transformOrigin = "100px 100px";

            hHint.classList.replace('opacity-0', 'opacity-30');
            mHint.classList.replace('opacity-0', 'opacity-30');
            
            playTick();
        }

        function hideHint() {
            document.getElementById('hour-hint').classList.replace('opacity-30', 'opacity-0');
            document.getElementById('min-hint').classList.replace('opacity-30', 'opacity-0');
        }

        // --- Interaction ---
        function handleDrag(e) {
            if (!activeHand || !isActive) return;
            const rect = document.getElementById('clock-svg').getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const angle = (Math.atan2(clientY - (rect.top + rect.height / 2), clientX - (rect.left + rect.width / 2)) * (180 / Math.PI) + 90 + 360) % 360;

            if (activeHand === 'min') {
                const snappedMins = Math.round(Math.round(angle / 6) / 5) * 5 % 60;
                if (playerTime.m !== snappedMins) { playerTime.m = snappedMins; playTick(); }
            } else {
                const snappedHours = Math.round(angle / 30) || 12;
                if (playerTime.h !== snappedHours) { playerTime.h = snappedHours; playTick(); }
            }
            updateVisuals();
        }

        document.getElementById('min-trigger').addEventListener('mousedown', () => activeHand = 'min');
        document.getElementById('hour-trigger').addEventListener('mousedown', () => activeHand = 'hour');
        document.getElementById('min-trigger').addEventListener('touchstart', (e) => { e.preventDefault(); activeHand = 'min'; });
        document.getElementById('hour-trigger').addEventListener('touchstart', (e) => { e.preventDefault(); activeHand = 'hour'; });
        window.addEventListener('mousemove', handleDrag);
        window.addEventListener('touchmove', handleDrag, { passive: false });
        window.addEventListener('mouseup', () => activeHand = null);
        window.addEventListener('touchend', () => activeHand = null);

        // --- Game Flow ---
        function submitAnswer() {
            if (!isActive) return;
            const isCorrect = playerTime.h === currentTarget.h && playerTime.m === currentTarget.m;
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedback-text');

            if (isCorrect) {
                score += (level + 1) * 100;
                document.getElementById('score').textContent = score;
                feedbackText.textContent = "CORRECT! âœ¨";
                feedbackText.className = "text-8xl font-title text-emerald-400 drop-shadow-2xl pop-in";
                showConfetti();
                playWin();
                generateQuestion();
            } else {
                feedbackText.textContent = "CHECK AGAIN â°";
                feedbackText.className = "text-8xl font-title text-red-400 drop-shadow-2xl pop-in";
                playFail();
            }

            feedback.style.opacity = "1";
            setTimeout(() => feedback.style.opacity = "0", 1000);
            updateStars();
        }

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            isActive = true;
            drawClock();
            generateQuestion();
            const timerObj = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `${timeLeft}s`;
                if (timeLeft <= 10) document.getElementById('timer').classList.add('text-red-500');
                if (timeLeft <= 0) { clearInterval(timerObj); endGame(); }
            }, 1000);
        }

        function endGame() {
            isActive = false;
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('final-score').textContent = score;
            const starCount = Math.min(5, Math.floor(score / 400));
            const container = document.getElementById('final-stars');
            container.innerHTML = '';
            for(let i=0; i<5; i++) {
                container.innerHTML += `<svg class="w-14 h-14 ${i < starCount ? 'text-yellow-400' : 'text-white/10'}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
            }
        }

        function updateStars() {
            const count = Math.min(5, Math.floor(score / 400));
            const row = document.getElementById('stars-row');
            row.innerHTML = '';
            for(let i=0; i<5; i++) row.innerHTML += `<div class="w-5 h-5 rounded-full ${i < count ? 'bg-yellow-400 shadow-[0_0_10px_#facc15]' : 'bg-white/10'}"></div>`;
        }

        // --- Audio/VFX ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTick() {
            const osc = audioCtx.createOscillator(); const g = audioCtx.createGain();
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.04);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.04);
        }
        function playWin() {
            [523, 659, 783, 1046].forEach((f, i) => {
                const osc = audioCtx.createOscillator(); const g = audioCtx.createGain();
                osc.frequency.setValueAtTime(f, audioCtx.currentTime + i*0.1);
                g.gain.setValueAtTime(0.1, audioCtx.currentTime + i*0.1);
                g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + i*0.1 + 0.4);
                osc.connect(g); g.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i*0.1); osc.stop(audioCtx.currentTime + i*0.1 + 0.4);
            });
        }
        function playFail() {
            const osc = audioCtx.createOscillator(); const g = audioCtx.createGain();
            osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.type = 'sawtooth';
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }

        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();
        function showConfetti() {
            for(let i=0; i<60; i++) particles.push({
                x: window.innerWidth/2, y: window.innerHeight/2,
                vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15,
                c: `hsl(${Math.random()*360}, 90%, 60%)`, s: Math.random()*8+3, l: 1
            });
        }
        function anim() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach((p,i) => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.25; p.l -= 0.015;
                ctx.fillStyle = p.c; ctx.globalAlpha = p.l;
                ctx.beginPath(); ctx.roundRect(p.x, p.y, p.s, p.s, 2); ctx.fill();
                if(p.l<=0) particles.splice(i,1);
            });
            requestAnimationFrame(anim);
        }
        anim();
    </script>
</body>
</html>