<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Decryptor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f2fe;
            --neon-purple: #bc13fe;
            --neon-pink: #ff00de;
        }
        body {
            background-color: #020617;
            color: white;
            font-family: 'Rajdhani', sans-serif;
            overflow: hidden;
            touch-action: none;
        }
        .title-font { font-family: 'Orbitron', sans-serif; }

        /* Scanning Effect */
        .data-core {
            width: 90px;
            height: 90px;
            position: absolute;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 242, 254, 0.1);
            border: 2px solid var(--neon-blue);
            border-radius: 15px;
            transition: background 0.3s, transform 0.1s;
            z-index: 20;
            user-select: none;
        }
        .data-core:active { cursor: grabbing; scale: 1.1; }
        .data-core .value {
            font-size: 2rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
            text-shadow: 0 0 10px var(--neon-blue);
        }
        .data-core:hover .value { opacity: 1; }

        /* The Reactor */
        #reactor {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 4px dashed var(--neon-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: rotate 10s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .reactor-core {
            position: absolute;
            inset: 10px;
            background: radial-gradient(circle, rgba(188, 19, 254, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { scale: 1; opacity: 0.5; } 50% { scale: 1.1; opacity: 1; } }

        /* Glitch Zone */
        .glitch-zone {
            position: absolute;
            background: linear-gradient(90deg, transparent, rgba(255, 0, 0, 0.2), transparent);
            height: 100%;
            width: 150px;
            pointer-events: none;
            z-index: 10;
            animation: sweep 8s linear infinite;
        }
        @keyframes sweep { from { left: -200px; } to { left: 120%; } }

        canvas#bg-canvas { position: fixed; inset: 0; z-index: -1; }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <div id="start-page" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-slate-950">
        <div class="relative mb-8">
            <svg width="200" height="200" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="40" fill="none" stroke="#00f2fe" stroke-width="2" stroke-dasharray="5 5"/>
                <path d="M30 50 L45 65 L70 35" stroke="#bc13fe" stroke-width="5" fill="none" stroke-linecap="round"/>
                <rect x="20" y="20" width="60" height="60" fill="none" stroke="#ff00de" stroke-width="1" opacity="0.5"/>
            </svg>
        </div>
        <h1 class="text-6xl font-bold title-font text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-fuchsia-500 mb-4">DECRYPTOR</h1>
        <p class="text-slate-400 tracking-[0.5em] mb-12">CHAPTER 2: ARITHMETIC SCANNER</p>
        <button onclick="startGame()" class="px-12 py-4 bg-transparent border-2 border-cyan-400 text-cyan-400 font-bold text-2xl hover:bg-cyan-400/10 transition-all rounded-lg uppercase tracking-widest">
            Initialize System
        </button>
    </div>

    <div id="game-ui" class="hidden fixed inset-0 p-8 flex flex-col pointer-events-none">
        <div class="flex justify-between items-start">
            <div class="bg-slate-900/80 p-4 border-l-4 border-cyan-400">
                <div class="text-xs text-cyan-500 font-bold uppercase">Stability Score</div>
                <div id="score" class="text-4xl font-bold">0000</div>
            </div>
            <div class="flex flex-col items-center">
                <div class="text-6xl font-bold title-font text-fuchsia-500" id="timer">60</div>
                <div class="text-[10px] uppercase tracking-[0.3em]">Seconds Remaining</div>
            </div>
            <div class="text-right bg-slate-900/80 p-4 border-r-4 border-fuchsia-500">
                <div class="text-xs text-fuchsia-500 font-bold uppercase">Combo Chain</div>
                <div id="combo" class="text-4xl font-bold">x1</div>
            </div>
        </div>

        <div class="mt-auto mb-12 flex flex-col items-center pointer-events-auto">
            <div class="mb-4 text-cyan-400 text-sm font-bold uppercase tracking-[0.2em]">Target Operation</div>
            <div id="problem-box" class="bg-slate-900/90 px-12 py-6 rounded-2xl border-2 border-slate-700 shadow-[0_0_30px_rgba(0,0,0,0.5)]">
                <div id="problem-text" class="text-7xl font-bold tracking-tight">-- + --</div>
            </div>
        </div>
    </div>

    <div id="reactor-container" class="hidden fixed inset-0 flex items-center justify-center">
        <div id="reactor">
            <div class="reactor-core"></div>
            <div class="absolute text-[10px] font-bold text-fuchsia-400 uppercase tracking-widest">Drop Core Here</div>
        </div>
        <div class="glitch-zone"></div>
    </div>

    <div id="end-page" class="hidden fixed inset-0 z-[100] bg-slate-950/95 flex flex-col items-center justify-center p-8 text-center">
        <h2 class="text-5xl font-bold title-font text-cyan-400 mb-2">SYSTEM SHUTDOWN</h2>
        <div id="stars" class="flex gap-4 my-8"></div>
        <div class="text-9xl font-black mb-4" id="final-score">0</div>
        <p class="text-slate-500 uppercase tracking-widest mb-12">Total Calculations Stabilized</p>
        <button onclick="location.reload()" class="border-2 border-fuchsia-500 text-fuchsia-500 px-16 py-4 rounded-full text-xl font-bold hover:bg-fuchsia-500/10">Reboot Session</button>
    </div>

    <script>
        // --- DATA & STATE ---
        let score = 0;
        let combo = 1;
        let timeLeft = 60;
        let gameActive = false;
        let currentAns = 0;
        let activeCores = [];
        let draggedElement = null;

        // --- BACKGROUND CANVAS ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        function drawBg() {
            ctx.fillStyle = '#020617';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'rgba(0, 242, 254, 0.05)';
            ctx.lineWidth = 1;
            for(let i=0; i<canvas.width; i+=50) {
                ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
            }
            for(let i=0; i<canvas.height; i+=50) {
                ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
            }
            requestAnimationFrame(drawBg);
        }
        drawBg();

        // --- SOUND ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function sfx(freq, type, dur) {
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = type; o.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + dur);
        }

        // --- GAMEPLAY FUNCTIONS ---
        function startGame() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('start-page').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            document.getElementById('reactor-container').classList.remove('hidden');
            gameActive = true;
            spawnNewProblem();
            startTimer();
        }

        function startTimer() {
            const t = setInterval(() => {
                if(!gameActive) return clearInterval(t);
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if(timeLeft <= 0) endGame();
            }, 1000);
        }

        function generateProblem() {
            const ops = ['+', '-', '×', '÷'];
            const op = ops[Math.floor(Math.random() * ops.length)];
            let a, b, ans;

            if(op === '+') { a = r(10, 80); b = r(10, 80); ans = a+b; }
            else if(op === '-') { a = r(50, 150); b = r(10, 49); ans = a-b; }
            else if(op === '×') { a = [2,3,4,5,10][r(0,4)]; b = r(2,12); ans = a*b; }
            else { b = [2,3,4,5,10][r(0,4)]; ans = r(1,12); a = ans * b; }
            
            return { text: `${a} ${op} ${b}`, ans };
        }

        function spawnNewProblem() {
            const prob = generateProblem();
            currentAns = prob.ans;
            document.getElementById('problem-text').innerText = prob.text;
            
            // Clear old cores
            activeCores.forEach(c => c.remove());
            activeCores = [];

            // Generate answer cores
            const values = [currentAns];
            while(values.length < 5) {
                let v = currentAns + r(-15, 15);
                if(v > 0 && !values.includes(v)) values.push(v);
            }
            values.sort(() => Math.random() - 0.5);

            values.forEach(val => {
                const core = document.createElement('div');
                core.className = 'data-core';
                core.innerHTML = `<span class="value">${val}</span>`;
                core.style.left = r(50, window.innerWidth - 150) + 'px';
                core.style.top = r(100, window.innerHeight - 300) + 'px';
                
                // Drifting motion
                const driftX = (Math.random() - 0.5) * 2;
                const driftY = (Math.random() - 0.5) * 2;
                
                core.dataset.vx = driftX;
                core.dataset.vy = driftY;
                core.dataset.val = val;

                setupDraggable(core);
                document.body.appendChild(core);
                activeCores.push(core);
            });
        }

        function setupDraggable(el) {
            let offset = { x: 0, y: 0 };
            
            el.addEventListener('pointerdown', (e) => {
                draggedElement = el;
                offset.x = e.clientX - el.offsetLeft;
                offset.y = e.clientY - el.offsetTop;
                el.style.zIndex = 1000;
                sfx(400, 'sine', 0.05);
            });

            document.addEventListener('pointermove', (e) => {
                if(draggedElement === el) {
                    el.style.left = (e.clientX - offset.x) + 'px';
                    el.style.top = (e.clientY - offset.y) + 'px';
                    checkReactor(el);
                }
            });

            document.addEventListener('pointerup', () => {
                if(draggedElement === el) {
                    draggedElement = null;
                    el.style.zIndex = 20;
                }
            });
        }

        function checkReactor(el) {
            const reactor = document.getElementById('reactor').getBoundingClientRect();
            const core = el.getBoundingClientRect();
            
            const dist = Math.hypot(
                (reactor.left + reactor.width/2) - (core.left + core.width/2),
                (reactor.top + reactor.height/2) - (core.top + core.height/2)
            );

            if(dist < 80) {
                if(parseInt(el.dataset.val) === currentAns) {
                    success();
                } else {
                    fail(el);
                }
            }
        }

        function success() {
            score += 100 * combo;
            combo++;
            sfx(800, 'sine', 0.2);
            document.getElementById('score').innerText = score.toString().padStart(4, '0');
            document.getElementById('combo').innerText = `x${combo}`;
            spawnNewProblem();
        }

        function fail(el) {
            combo = 1;
            sfx(100, 'square', 0.3);
            document.getElementById('combo').innerText = `x1`;
            el.style.borderColor = '#ff0000';
            setTimeout(() => el.style.borderColor = '#00f2fe', 500);
            draggedElement = null;
            el.style.left = r(50, window.innerWidth-150) + 'px';
            el.style.top = r(100, window.innerHeight-300) + 'px';
        }

        // Drifting loop
        setInterval(() => {
            if(!gameActive) return;
            activeCores.forEach(c => {
                if(draggedElement === c) return;
                let lx = parseFloat(c.style.left);
                let ly = parseFloat(c.style.top);
                let vx = parseFloat(c.dataset.vx);
                let vy = parseFloat(c.dataset.vy);
                
                if(lx < 0 || lx > window.innerWidth - 100) c.dataset.vx = -vx;
                if(ly < 0 || ly > window.innerHeight - 200) c.dataset.vy = -vy;
                
                c.style.left = (lx + vx) + 'px';
                c.style.top = (ly + vy) + 'px';
            });
        }, 30);

        function endGame() {
            gameActive = false;
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('reactor-container').classList.add('hidden');
            document.getElementById('end-page').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            
            const stars = score > 3000 ? 3 : score > 1500 ? 2 : 1;
            const container = document.getElementById('stars');
            for(let i=0; i<3; i++) {
                container.innerHTML += `<svg width="60" height="60" viewBox="0 0 24 24" fill="${i < stars ? '#00f2fe' : '#1e293b'}"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`;
            }
        }

        function r(min, max) { return Math.floor(Math.random() * (max - min + 1) + min); }
    </script>
</body>
</html>